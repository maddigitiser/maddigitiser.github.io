<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Creating a new domain on Windows Azure by maddigitiser</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Creating a new domain on Windows Azure</h1>
        <h2></h2>
        <a href="https://github.com/maddigitiser" class="button"><small>Follow me on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>Creating a new domain on Windows Azure</h1>

<p>I've spent a few hours in the past week getting a test domain set up on Azure so I can do some testing for some software I'm writing to control directory sync with Office 365 (in particular, Azure Active Directory).  There's some guides out there that give you some tips, but I found some technical errors in them and they didn't detail the full solution end-to-end.  My approach had to be repeatable so it focuses on Powershell - you'll need the the Azure SDK to installed to run these steps.  For the record, joining a new Azure VM a domain is far, far easier using PS than the portal.  </p>

<h3>Creating the machine</h3>

<pre><code>cls

Import-Module "C:\Program Files (x86)\Microsoft SDKs\Windows Azure\PowerShell\Azure\Azure.psd1"
Import-AzurePublishSettingsFile 'MyAzureSettings.publishsettings'
Set-AzureSubscription -SubscriptionName '{subscription name}' -CurrentStorageAccount '{storage account}'
Select-AzureSubscription -SubscriptionName '{subscription name}'

#Deploy the Domain Controller in a virtual network
#-------------------------------------------------


#Specify my DC's DNS IP (127.0.0.1)
$myDNS = New-AzureDNS -Name 'MyThrowawayInternalDnsName' -IPAddress '127.0.0.1'
$vmname = 'MyMachineName'
# OS Image to Use
$image = 'a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-Datacenter-201303.01-en.us-127GB.vhd'
$AG = 'MyAffinityGroup'
$vnet = 'MyVNet'


#VM Configuration
$MyDC = New-AzureVMConfig -name $vmname -InstanceSize 'Small' -ImageName $image |
    Add-AzureProvisioningConfig -Windows -Password '{password}' |
        Set-AzureSubnet -SubnetNames '{subnet name}'


New-AzureVM -ServiceName $vmname -AffinityGroup $AG -VMs $MyDC -DnsSettings $myDNS -VNetName $vnet
</code></pre>
        </section>

        <aside id="sidebar">


          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>