{"name":"Creating a new domain on Windows Azure","tagline":"","body":"# Creating a new domain on Windows Azure\r\nI've spent a few hours in the past week getting a domain set up on Azure so I can do some testing for some software I'm writing to control directory sync with Office 365 (in particular, Azure Active Directory).  There's some guides out there that give you some tips, but I found some technical errors in them and they didn't detail the full solution end-to-end.  My approach had to be repeatable so it focuses on Powershell - you'll need the the Azure SDK to installed to run these steps.  For the record, joining a new Azure VM a domain is far, far easier using PS than the portal.  \r\n\r\n### Creating the machine\r\n\r\n```\r\ncls\r\n\r\nImport-Module \"C:\\Program Files (x86)\\Microsoft SDKs\\Windows Azure\\PowerShell\\Azure\\Azure.psd1\"\r\nImport-AzurePublishSettingsFile 'MyAzureSettings.publishsettings'\r\nSet-AzureSubscription -SubscriptionName '{subscription name}' -CurrentStorageAccount '{storage account}'\r\nSelect-AzureSubscription -SubscriptionName '{subscription name}'\r\n\r\n#Deploy the Domain Controller in a virtual network\r\n#-------------------------------------------------\r\n\r\n\r\n#Specify my DC's DNS IP (127.0.0.1)\r\n$myDNS = New-AzureDNS -Name 'MyThrowawayInternalDnsName' -IPAddress '127.0.0.1'\r\n$vmname = 'MyMachineName'\r\n# OS Image to Use\r\n$image = 'a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-Datacenter-201303.01-en.us-127GB.vhd'\r\n$AG = 'MyAffinityGroup'\r\n$vnet = 'MyVNet'\r\n\r\n\r\n#VM Configuration\r\n$MyDC = New-AzureVMConfig -name $vmname -InstanceSize 'Small' -ImageName $image |\r\n    Add-AzureProvisioningConfig -Windows -Password '{password}' |\r\n        Set-AzureSubnet -SubnetNames '{subnet name}'\r\n\r\n\r\nNew-AzureVM -ServiceName $vmname -AffinityGroup $AG -VMs $MyDC -DnsSettings $myDNS -VNetName $vnet\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}